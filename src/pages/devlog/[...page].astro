---
import type { Page, GetStaticPaths } from "astro";
import type { CollectionEntry } from "astro:content";
import PageLayout from "@/layouts/Base";
import DevlogPreview from "@/components/devlog/DevlogPreview";
import Pagination from "@/components/Paginator";
import { getAllDevlogEntries, sortDevlogByDate } from "@/utils";

export const getStaticPaths = (async ({ paginate }) => {
	const allEntries = await getAllDevlogEntries();
	const allEntriesByDate = sortDevlogByDate(allEntries);
	return paginate(allEntriesByDate, { pageSize: 20 });
}) satisfies GetStaticPaths;

interface Props {
	page: Page<CollectionEntry<"devlog">>;
}

const { page } = Astro.props;

const meta = {
	title: "Devlog",
	description: "A development diary capturing the daily texture of building things",
};

const paginationProps = {
	...(page.url.prev && {
		prevUrl: {
			url: page.url.prev,
			text: `← Newer Entries`,
		},
	}),
	...(page.url.next && {
		nextUrl: {
			url: page.url.next,
			text: `Older Entries →`,
		},
	}),
};
---

<PageLayout meta={meta}>
	<h1 class="title mb-6">Devlog</h1>
	<section aria-label="Devlog entries">
		<ul class="space-y-8 text-start">
			{
				page.data.map((entry) => (
					<li class="flex flex-col flex-wrap gap-2 sm:flex-row [&_q]:basis-full">
						<DevlogPreview entry={entry} as="h2" />
					</li>
				))
			}
		</ul>
		<Pagination {...paginationProps} />
	</section>
</PageLayout>
